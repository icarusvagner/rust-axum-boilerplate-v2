-- Add migration script here
CREATE TYPE admin_typ AS ENUM('Super', 'Admin', 'Sub', 'User');
CREATE TYPE admin_stat AS ENUM('Active', 'Inactive', 'Busy', 'Unavailable');

CREATE TABLE tbl_admin (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
	uname VARCHAR(255) NOT NULL UNIQUE,
	email VARCHAR(255) NOT NULL UNIQUE,
	pwd VARCHAR(255),
	pwd_salt uuid NOT NULL DEFAULT gen_random_uuid() UNIQUE,
	token_salt uuid NOT NULL DEFAULT gen_random_uuid() UNIQUE,
	admin_role admin_typ NOT NULL DEFAULT 'User',
	admin_stat admin_stat NOT NULL DEFAULT 'Active',
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

CREATE TABLE tbl_details (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
  admin_id BIGINT NOT NULL UNIQUE,
	first_name VARCHAR(255) NOT NULL,
	last_name VARCHAR(255) NOT NULL,
	birth_date DATE NOT NULL,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

CREATE TABLE tbl_acc_removed (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
  admin_id BIGINT NOT NULL UNIQUE,
	uname VARCHAR(255) NOT NULL UNIQUE,
	email VARCHAR(255) NOT NULL UNIQUE,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

CREATE TABLE tbl_removed_acc_history (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
  admin_id BIGINT NOT NULL UNIQUE,
	uname VARCHAR(255) NOT NULL UNIQUE,
	email VARCHAR(255) NOT NULL UNIQUE,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

CREATE TABLE tbl_book (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
	img_path VARCHAR(255) NOT NULL,
	title VARCHAR(255) NOT NULL,
  link_to VARCHAR(255) NOT NULL,
	price DECIMAL(10,2),
	stock_quantity INTEGER,
	total_stock INTEGER,
	book_status SMALLINT NOT NULL DEFAULT 0,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  PRIMARY KEY(id)
);

CREATE TABLE tbl_category (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
	cat_name VARCHAR(255) NOT NULL,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

CREATE TABLE tbl_categories (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000),
	book_id BIGINT NOT NULL,
	cat_id BIGINT NOT NULL,
	cid BIGINT,
	ctime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	mid BIGINT,
	mtime TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	PRIMARY KEY(id)
);

ALTER TABLE tbl_details
ADD FOREIGN KEY(admin_id) REFERENCES tbl_admin(id)
ON DELETE CASCADE;

ALTER TABLE tbl_categories
ADD FOREIGN KEY(book_id) REFERENCES tbl_book(id)
ON DELETE CASCADE;

ALTER TABLE tbl_categories
ADD FOREIGN KEY(cat_id) REFERENCES tbl_category(id)
ON DELETE CASCADE;

